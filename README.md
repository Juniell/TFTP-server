# TFTP-сервер

Представляет собой программу, позволяющую выполнять роль TFTP-сервера.

## Запуск программы
```
./gradlew build
java -jar TFTP-server-1.0-SNAPSHOT.jar [-p port] [-d directoryName] [-l log]
```

### Аргументы командной строки
- \[-p port] - порт, на котором будет запущен сервер. Необязательный, по умолчанию равен 69;
- \[-d directoryName] - имя директории, с которой будет работать сервер. Необязательный, по умолчанию "TFTPFiles";
- \[-l log] - наличие логов. Необязательный, по умолчанию true.

# TFTP

TFTP поддерживает 5 типов пакетов, формат которых зависит от Opcode (код операции):

| opcode | операция                     |
|:------:|:-----------------------------|
|   1    | RRQ - запрос на чтение       |
|   2    | WRQ - запрос на запись       |
|   3    | DATA- пакет с данными        |
|   4    | ACK - пакет-подтверждение    |
|   5    | ERROR - сообщение об ошибке  |

Заголовок TFTP пакета содержит код операции.

## Формат RRQ/WRQ пакетов

| 2 bytes |  string  | 1 byte | string | 1 byte |
|:-------:|:--------:|:------:|:------:|:------:|
| Opcode  | Filename |   0    |  Mode  |   0    |

### Opcode
Содержит в себе код операции 1 или 2 (RRQ и WRQ соответственно).

### Filename
Является последовательностью байтов в netascii названия интересующего файла. 
Оканчивается нулевым байтом.

### Mode
Строка «netascii», «octet» или «mail» (последний считается устаревшим) в netascii. 
Оканчивается нулевым байтом.
Указывает на один из трёх режимов передачи, определённых в протоколе.

## Формат DATA пакета

| 2 bytes | 2 bytes  | n bytes  |
|:--------|:--------:|:--------:|
| Opcode  | Block #  |   Data   |

### Opcode
Содержит в себе код операции 3 (DATA).

### Block \#
Содержит номер отправляемого блока данных.
Изначально нумерация начинается с 1, после чего увеличивается для каждого последующего отправляемого блока.
Позволяет отличить новый блок данных от дубликата.

### Data
Поле для данных передаваемого файла. 
Имеет максимальную длину 512 байт.
Если длина этого поля в пакете 512 байт, значит это не последний блок данных.
Если длина этого поля в пакете от 0 до 511 байт, значит это последний блок данных, что говорит об окончании передачи.

## Формат пакета ACK

| 2 bytes | 2 bytes  |
|:-------:|:--------:|
| Opcode  | Block #  |

### Opcode
Содержит в себе код операции 4 (ACK).

### Block \#
Содержит номер блока подтверждаемого пакета DATA.
Block # должен быть = 0, если это подтверждение пакета WRQ.

## Формат пакета ERROR

| 2 bytes |  2 bytes   | string  | 1 byte  |
|:-------:|:----------:|:-------:|:-------:|
| Opcode  | ErrorCode  | ErrMsg  |    0    |

### Opcode
Содержит в себе код операции 5 (ERROR).

### ErrorCode
Целое число с кодом ошибки из приведённых ниже:

- 0 - Не определено, см. Сообщение об ошибке (если есть),
- 1 - Файл не найден,
- 2 - Нарушение доступа,
- 3 - Диск переполнен или выделение превышено,
- 4 - Незаконная операция TFTP.
- 5 - Неизвестный идентификатор передачи,
- 6 - Файл уже существует.
- 7 - Нет такого пользователя.

### ErrMsg
Сообщение об ошибке, поясняющее её. В формате netascii. 
Заканчивается нулевым байтом.
